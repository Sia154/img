# 第二章日志分析-redis应急响应

## 1通过本地 PC SSH到服务器并且分析黑客攻击成功的 IP 为多少,将黑客 IP 作为 FLAG 提交;

连接下载日记

![image-20250218095150136](第二章日志分析-redis应急响应.assets/image-20250218095150136.png)

查看日记

Redis版本号查询命令；（也可以直接使用——redis-server --version）

```
redis-cli INFO | grep redis_version
```

![image-20250218095507433](第二章日志分析-redis应急响应.assets/image-20250218095507433.png)

网络搜索发现

对于 Redis 5.0.1，未授权访问 是最常见且可能性最大的漏洞，尤其是在 Redis 默认配置下没有设置密码的情况下。攻击者可以通过未授权访问执行以下操作：

    读取和修改数据：攻击者可以读取 Redis 数据库中的所有数据，甚至可以删除或修改数据。
    远程代码执行：攻击者可以利用 CONFIG 命令修改配置文件来写入恶意代码，从而在目标服务器上执行任意代码。
    持久化恶意代码：通过修改 Redis 的持久化配置，攻击者可以在服务器重启时执行恶意操作。
因为日志不是很多，算比较少的，往下翻一些就发现了“192.168.100.13”这个IP一直想与 Redis 实例尝试与主服务器（MASTER）进行同步（SYNC），但连接被拒绝（Connection refused）；

发现连接成功

![image-20250218100154720](第二章日志分析-redis应急响应.assets/image-20250218100154720.png)

并执行了

![image-20250218100035740](第二章日志分析-redis应急响应.assets/image-20250218100035740.png)

```
flag{192.168.100.20}
```

## 2通过本地 PC SSH到服务器并且分析黑客第一次上传的恶意文件,将黑客上传的恶意文件里面的 FLAG 提交;

将上一题的执行文件分析

![image-20250218100405530](第二章日志分析-redis应急响应.assets/image-20250218100405530.png)

![image-20250218100551053](第二章日志分析-redis应急响应.assets/image-20250218100551053.png)

使用010分析搜索flag

![image-20250218100714982](第二章日志分析-redis应急响应.assets/image-20250218100714982.png)

```
flag{XJ_78f012d7-42fc-49a8-8a8c-e74c87ea109b}
```

## 3通过本地 PC SSH到服务器并且分析黑客反弹 shell 的IP 为多少,将反弹 shell 的IP 作为 FLAG 提交;

查看定时计划

```
crontab -l
```

![image-20250218100900049](第二章日志分析-redis应急响应.assets/image-20250218100900049.png)

发现存在定时计划ip地址是

```
flag{192.168.100.13}
```



## 4通过本地 PC SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串(flag{黑客的用户-关键字符串} 注关键字符串 xxx-xxx-xxx)。将用户名和关键字符串作为 FLAG提交

    题目让我们溯源查找黑客的用户名，并且找到黑客使用工具的关键字符串，那这里我们检查 一下SSH 登录日志，通常 SSH 登录的日志记录在系统的安全日志文件中，但是，SSH（Secure Shell）提供了两种主要的登录验证方式；

1. 密码验证（Password Authentication）

工作原理：

    用户在登录时需要提供用户名和密码。
    服务器接收用户名和密码后，验证它们是否匹配预先存储的凭证。
    如果用户名和密码正确，用户即可登录服务器。

2. 公钥验证（Public Key Authentication）

工作原理：

    用户生成一对 SSH 密钥对，包括私钥和公钥。
    公钥被上传并存储在目标服务器的用户账户下的 ~/.ssh/authorized_keys 文件中。
    用户在登录时使用其私钥进行身份验证。
    服务器通过匹配用户提供的私钥和存储的公钥来验证用户身份。
    如果匹配成功，用户即可登录服务器。

所以我们可以从两点看出；

    Redis 配置：黑客利用 Redis 的未授权访问或其他漏洞，将自己的公钥写入了服务器的 ~/.ssh/authorized_keys 文件中，从而可以使用 SSH 公钥验证进行登录。
    登录日志：SSH 登录日志通常会显示使用的验证方式。虽然在提供的日志中没有明确显示公钥验证，但结合 Redis 被利用的情况，可以推测黑客可能通过这种方式获取了访问权限。

也就是说会向靶机上写入SSH密钥，那我们查看一下靶机的/root/.ssh

![image-20250218101353878](第二章日志分析-redis应急响应.assets/image-20250218101353878.png)

存在文件查看

![image-20250218101440943](第二章日志分析-redis应急响应.assets/image-20250218101440943.png)

发现用户名xj-test-user，搜索

![image-20250218101609154](第二章日志分析-redis应急响应.assets/image-20250218101609154.png)

![image-20250218102053255](第二章日志分析-redis应急响应.assets/image-20250218102053255.png)

```
wow-you-find-flag
```

```
flag{黑客的用户-关键字符串} flag{xj-test-user-wow-you-find-flag}
```

## 5通过本地 PC SSH到服务器并且分析黑客篡改的命令,将黑客篡改的命令里面的关键字符串作为 FLAG 提交;

审查系统日志查看系统的认证日志（如`/var/log/auth.log`或`/var/log/secure`），寻找异常的登录记录，特别是来自非授权用户或IP的登录尝试。没有

history没有

`/usr/bin` 是 Linux 和类 Unix 系统中的一个重要目录，它用于存放系统中大多数用户可执行的命令和程序。排查到“系统路径中的命令”时，发现了有一点特别的地方

![image-20250218102709600](第二章日志分析-redis应急响应.assets/image-20250218102709600.png)

![image-20250218102745105](第二章日志分析-redis应急响应.assets/image-20250218102745105.png)

```
flag{c195i2923381905517d818e313792d196}
```

